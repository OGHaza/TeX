
<!-- Playlist -->
<div @openClose *ngIf="showPlaylist" class="player-box z-50 max-h-80 overflow-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-400">
    <div class="flex items-center justify-between px-3 py-2 border-b border-gray-700/50">
        <p class="text-sm font-semibold" translate="">player.playlist</p>
        <button (click)="toggleDisplayPlaylist()" class="text-gray-400 hover:text-white p-1"><fa-icon [icon]="['fas', 'times']"></fa-icon></button>
    </div>
    <app-playlist-item *ngFor="let item of player.currentPlayer?.playlistItems; let i = index" [item]="item" [position]="i" ></app-playlist-item>
</div>


<!-- Player -->
<div @openClose *ngIf="!showPlaylist" class="player-box z-40 relative">

    <!-- Poster thumbnail -->
    <img *ngIf="player.currentPlayer?.playerIllustration" 
         [src]="player.currentPlayer?.playerIllustration" 
         (error)="onImageError($event)"
         class="absolute left-2 sm:left-8 top-1/2 -translate-y-1/2 w-12 sm:w-16 h-16 sm:h-24 object-cover rounded shadow-lg opacity-80 mr-2">

    <div *ngIf="player.players.length > 1" class="w-full px-3 sm:px-10 pl-20 sm:pl-28">
        <button class="custom-button group relative flex mx-auto my-2 text-sm">
            {{ player.currentPlayer?.title ?? "unknown" | translate }}
            <div class="floating-button-bottom-left m-auto pointer-group-button min-w-full z-60">
                <div class="floating-list z-60">
                    <div (click)="player.showPlayer(i)" class="floating-button z-60" *ngFor="let pl of player.players; let i = index" >
                        <label>{{ pl.title | translate}}</label>
                    </div>
                </div>
            </div>
        </button>
    </div>


    <div *ngIf="!player.currentPlayer?.playerItem" class="text-center w-full flex flex-col justify-center pl-20 sm:pl-28" style="height: 92px;">
        <p class="text-sm text-gray-400" translate="player.noMedia"></p>
    </div>

    <div *ngIf="player.currentPlayer?.playerItem" class="w-full flex flex-col px-3 sm:px-10 pl-20 sm:pl-28">

        <!-- Row 1 -->
        <div class="w-full flex items-center justify-between py-1">
            <!-- Transport controls -->
            <div class="flex items-center gap-2 text-sm">
                <button (click)="player.currentPlayer?.goBackward()" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'step-backward']"></fa-icon></button>
                <button (click)="player.currentPlayer?.stop();close()" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'stop']"></fa-icon></button>
                <button (click)="player.currentPlayer?.setFixedSeek(-15)" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'undo']"></fa-icon></button>
                <button class="text-primary text-lg hover:opacity-80 active:opacity-100 transition-opacity" (click)="player.currentPlayer?.tooglePlayPause()" >
                    <fa-icon [icon]="['fas', player.currentPlayer?.isPlaying() ? 'pause' : 'play']"></fa-icon>
                </button>
                <button (click)="player.currentPlayer?.setFixedSeek(15)" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'redo']"></fa-icon></button>
                <button (click)="player.currentPlayer?.goForward()" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'step-forward']"></fa-icon></button>
            </div>

            <!-- Options: playlist, language, subtitles -->
            <div class="flex items-center gap-2 text-sm">
                <button (click)="toggleDisplayPlaylist()" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors"><fa-icon [icon]="['fas', 'list']"></fa-icon></button>
                
                <!-- Audio streams -->
                <button *ngIf="player.currentPlayer?.playerItem?.type != 'song' && player.currentPlayer?.properties?.audiostreams?.length != 0" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors group relative">
                    <fa-icon [icon]="['fas', 'globe']"></fa-icon>
                    <div class="floating-button-bottom-right pointer-group-button min-w-full z-60">
                        <div class="floating-list floating-button-top z-60">
                            <p class="whitespace-nowrap px-2 py-1 text-xs z-60" translate="player.languages"></p>
                            <p *ngFor="let audiostream of player.currentPlayer?.properties?.audiostreams" (click)="player.currentPlayer?.setAudioStream(audiostream)" class="floating-button z-60 {{ audiostream.index == player.currentPlayer?.properties?.currentaudiostream?.index ? 'text-white' : 'text-gray-500 hover:text-white' }}  text-xs">
                                {{ audiostream.language != "" ? audiostream.language : "Unknown" }}
                            </p>
                        </div>
                    </div>
                </button>

                <!-- Subtitles -->
                <button *ngIf="player.currentPlayer?.playerItem?.type != 'song' && player.currentPlayer?.properties?.subtitles?.length != 0" class="text-gray-400 hover:text-gray-200 active:text-primary transition-colors group relative">
                    <fa-icon [icon]="[player.currentPlayer?.properties?.subtitleenabled ? 'fas' : 'fas', 'closed-captioning']" ></fa-icon>
                    <div class="floating-button-bottom-right pointer-group-button min-w-full z-60">
                        <div class="floating-list floating-button-top z-60">
                            <p class="whitespace-nowrap px-2 py-1 text-xs z-60" translate="player.subtitles"></p>
                            <p *ngFor="let subtitle of player.currentPlayer?.properties?.subtitles" (click)="player.currentPlayer?.toggleSubtitle()" class="floating-button z-60 {{ !player.currentPlayer?.properties?.subtitleenabled ? 'text-white' : 'text-gray-500 hover:text-white' }} text-xs" translate="player.disabled"></p>
                            <p *ngFor="let subtitle of player.currentPlayer?.properties?.subtitles" (click)="player.currentPlayer?.setSubtitle(subtitle)" class="floating-button z-60 {{ (subtitle.index == player.currentPlayer?.properties?.currentsubtitle?.index) && player.currentPlayer?.properties?.subtitleenabled ? 'text-white' : 'text-gray-500 hover:text-white' }} text-xs">
                                {{ subtitle.language }} {{ subtitle.isforced ? "(forc√©)" : "" }}
                            </p>
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="w-full flex items-center justify-between py-1">
            <!-- Title -->
            <div class="flex-1 min-w-0 mr-4">
                <p *ngIf="player.currentPlayer?.playerItem?.type == 'movie'" class="text-sm font-semibold truncate">
                    {{ player.currentPlayer?.playerItem?.title }}
                </p>
                <div *ngIf="player.currentPlayer?.playerItem?.type == 'episode'" class="truncate">
                    <p class="text-sm font-semibold truncate">{{ player.currentPlayer?.playerItem?.showtitle }} - S{{ player.currentPlayer?.playerItem?.season }}E{{ player.currentPlayer?.playerItem?.episode }}</p>
                </div>
                <div *ngIf="player.currentPlayer?.playerItem?.type == 'song'" class="truncate">
                    <p class="text-sm font-semibold truncate">{{ player.currentPlayer?.playerItem?.artist }} - {{ player.currentPlayer?.playerItem?.title }}</p>
                </div>
            </div>

            <!-- Times -->
            <div class="text-xs text-gray-400 tabular-nums">
                <span>{{ getSongDuration(player.currentPlayer?.properties?.time, player.currentPlayer?.playerItem?.type != 'song') }}</span>
                <span class="mx-1">/</span>
                <span>{{ getSongDuration(player.currentPlayer?.properties?.totaltime, player.currentPlayer?.playerItem?.type != 'song')}}</span>
            </div>
        </div>

        <!-- Row 3: Seekbar -->
        <div class="w-full mb-1">
            <input
                #ref
                (change)="player.currentPlayer?.setSeek(ref.value)"
                class="w-full cursor-pointer player-seekbar"
                min="0"
                max="100"
                value="{{ player.currentPlayer?.properties?.percentage }}"
                type="range"
                [ngStyle]="{'--seek-percent': (player.currentPlayer?.properties?.percentage ?? 0) + '%'}"
            >
        </div>

    </div>
</div>

