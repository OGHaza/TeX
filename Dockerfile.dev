FROM node:18-bullseye-slim

WORKDIR /app

# Install deps first (better build caching)
COPY package.json package-lock.json ./
RUN npm config set registry https://registry.npmjs.org/ \
  && npm config set fetch-retries 5 \
  && npm config set fetch-retry-mintimeout 20000 \
  && npm config set fetch-retry-maxtimeout 120000 \
  && npm ci --legacy-peer-deps --no-audit --no-fund

# Copy the rest of the repo (will be overridden by bind-mount in docker-compose for live dev)
COPY . .

EXPOSE 4200

CMD ["npm", "start", "--", "--host", "0.0.0.0", "--port", "4200", "--poll", "2000"]
